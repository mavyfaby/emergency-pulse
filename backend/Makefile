BIN_NAME=pulse

# ðŸ‘‡ Build the binary (production)
.PHONY: build
build: tidy
	@CGO_ENABLED=0 GOEXPERIMENT=greenteagc go build -trimpath -tags=production -ldflags "-s -w" -o bin/$(BIN_NAME) cmd/app/main.go
	@echo "Build complete!"

# ðŸ‘‡ Shared logic for building
.PHONY: tidy
tidy:
	@go mod tidy
	@echo "Building $(BIN_NAME)..."

# ðŸ‘‡ Run the binary
.PHONY: run
run:
	@./bin/$(BIN_NAME)

# ðŸ‘‡ Dev mode with Swagger + formatting
.PHONY: dev
dev: fmt docs
	@go run cmd/app/main.go

# ðŸ‘‡ Create Swagger docs
.PHONY: docs
docs:
	@swag init -g internal/app/main.go --output internal/app/docs

# ðŸ‘‡ Format code & Swagger
.PHONY: fmt
fmt:
	@echo "Formatting swagger docs..."
	@swag fmt

# ðŸ‘‡ Clean binary output
.PHONY: clean
clean:
	@echo "Cleaning up..."
	@go clean
	@rm -rf bin/